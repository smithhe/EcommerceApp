#--------------------------------------------------------------------
# Global values
#--------------------------------------------------------------------
secrets:
  secretName: ecommerce-secrets
  keys:
    EcommerceJwtSettingsKey: EcommerceJwtSettingsKey
    EcommercePaypalClientId: EcommercePaypalClientId
    EcommercePaypalSecret: EcommercePaypalSecret
    EcommerceRabbitMQUsername: EcommerceRabbitMQUsername
    EcommerceRabbitMQPassword: EcommerceRabbitMQPassword
    EcommerceMailSettingsHost: EcommerceMailSettingsHost
    EcommerceMailSettingsPort: EcommerceMailSettingsPort
    EcommerceMailSettingsUserName: EcommerceMailSettingsUserName
    EcommerceMailSettingsPassword: EcommerceMailSettingsPassword
  values:
    EcommerceJwtSettingsKey: ""
    EcommercePaypalClientId: ""
    EcommercePaypalSecret: ""
    EcommerceRabbitMQUsername: ""
    EcommerceRabbitMQPassword: ""
    EcommerceMailSettingsHost: ""
    EcommerceMailSettingsPort: ""
    EcommerceMailSettingsUserName: ""
    EcommerceMailSettingsPassword: ""

# IF you change these values
# MAKE SURE they match what is put in the kubernetes.tf file
connectionString:
  secretName: "ecommerce-database"
  secretKey: "connection-string"


#--------------------------------------------------------------------
# Project specific values
#--------------------------------------------------------------------
api:
  selector: ecommerce-api

ui:
  selector: ecommerce-ui

worker:
  selector: ecommerce-worker

rabbitmq:
  selector: rabbitmq

#--------------------------------------------------------------------
# Deployment specific values
#--------------------------------------------------------------------
deployments:

  #--------------------------------------------------------------------
  # Api
  #--------------------------------------------------------------------
  api:
    name: ecommerce-api-deployment
    container:
      name: ecommerce-api
      ports:
        - port: 80
          protocol: TCP
        - port: 443
          protocol: TCP
    image:
      repository: smithhe95/ecommerce-api
      tag: latest
    pullPolicy: Always
    resources:
      limits:
        cpu: "250m"
        memory: "256Mi"
    environment:
      UiUrl: "https://ecommerce.codesmithing.io"
      ApiUrl: "https://api.ecommerce.codesmithing.io"

  #--------------------------------------------------------------------
  # UI
  #--------------------------------------------------------------------
  ui:
    name: ecommerce-ui-deployment
    environment: QA
    container:
      name: ecommerce-ui
      ports:
        - port: 80
          protocol: TCP
        - port: 443
          protocol: TCP
    image:
      repository: smithhe95/ecommerce-ui
      tag: latest
    pullPolicy: Always
    resources:
      limits:
        cpu: "50m"
        memory: "74Mi"

  #--------------------------------------------------------------------
  # Worker
  #--------------------------------------------------------------------
  worker:
    name: ecommerce-worker-deployment
    container:
      name: ecommerce-worker
    image:
      repository: smithhe95/ecommerce-worker
      tag: latest
    pullPolicy: Always
    ports:
        - port: 15672
          protocol: TCP
        - port: 5672
          protocol: TCP
    resources:
      limits:
        cpu: "250m"
        memory: "256Mi"

  #--------------------------------------------------------------------
  # RabbitMQ
  #--------------------------------------------------------------------
  rabbitmq:
    name: rabbitmq-deployment
    container:
      name: rabbitmq
    pullPolicy: Always
    resources:
      limits:
        cpu: "50m"
        memory: "128Mi"



#--------------------------------------------------------------------
# Service specific values
#--------------------------------------------------------------------
services:

  #--------------------------------------------------------------------
  # Api
  #--------------------------------------------------------------------
  api:
    name: ecommerce-api-service
    type: ClusterIP
    ports:
      - name: http
        port: 80
        targetPort: 8080
        protocol: TCP
      - name: https
        port: 443
        targetPort: 443
        protocol: TCP
  
  #--------------------------------------------------------------------
  # UI
  #--------------------------------------------------------------------
  ui:
    name: ecommerce-ui-service
    type: ClusterIP
    ports:
      - name: http
        port: 80
        targetPort: 80
        protocol: TCP
      - name: https
        port: 443
        targetPort: 443
        protocol: TCP

  #--------------------------------------------------------------------
  # RabbitMQ
  #--------------------------------------------------------------------
  rabbitmq:
    name: ecommerce-rabbitmq-service
    type: ClusterIP
    ports:
      - name: dashboard
        port: 15672
        targetPort: 15672
        protocol: TCP
      - name: queues
        port: 5672
        targetPort: 5672
        protocol: TCP



#--------------------------------------------------------------------
# HPA specific values
#--------------------------------------------------------------------
autoscalers:

  #--------------------------------------------------------------------
  # Api
  #--------------------------------------------------------------------
  api:
    name: ecommerce-api-hpa
    replicas:
      min: 1
      max: 3
    averageUtilization: 80

  #--------------------------------------------------------------------
  # UI
  #--------------------------------------------------------------------
  ui:
    name: ecommerce-ui-hpa
    replicas:
      min: 1
      max: 2
    averageUtilization: 80
  
  #--------------------------------------------------------------------
  # Worker
  #--------------------------------------------------------------------
  worker:
    name: ecommerce-worker-hpa
    replicas:
      min: 1
      max: 2
    averageUtilization: 80



#--------------------------------------------------------------------
# Ingress specific values cert-manager.io/issuer: lets-encrypt-cluster-issuer
#--------------------------------------------------------------------
ingress:
  enabled: true
  name: ecommerce-ingress
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/issuer: "letsencrypt-issuer-prod"
    
  tls:
    - secretName: ecommerce-ui-tls
      hosts:
        - ecommerce.codesmithing.io
    - secretName: ecommerce-api-tls
      hosts:
        - api.ecommerce.codesmithing.io
  hosts:
    - host: api.ecommerce.codesmithing.io
      paths:
        - path: /
          pathType: Prefix
          service:
            name: ecommerce-api-service
            port: 80
    - host: ecommerce.codesmithing.io
      paths:
        - path: /
          pathType: Prefix
          service:
            name: ecommerce-ui-service
            port: 80